tasks:
  - name: "test-mongodb-latest-loadbalanced"
    tags: ["sharded", "local", "latest", "loadbalanced"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          TOPOLOGY: "sharded_cluster"
          MONGODB_VERSION: "latest"
          LOAD_BALANCER: "true"
          SSL: "yes"
      - func: "start load balancer"
      - func: "run tests"
        vars:
          MONGODB_URI: "${SINGLE_MONGOS_LB_URI}"
          SSL: "yes"

  - name: "test-mongodb-rapid-loadbalanced"
    tags: ["sharded", "local", "rapid", "loadbalanced"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          TOPOLOGY: "sharded_cluster"
          MONGODB_VERSION: "rapid"
          LOAD_BALANCER: "true"
          SSL: "yes"
      - func: "start load balancer"
      - func: "run tests"
        vars:
          MONGODB_URI: "${SINGLE_MONGOS_LB_URI}"
          SSL: "yes"
      # Note: "stop load balancer" will be called from "post"

  - name: "test-mongodb-7.0-loadbalanced"
    tags: ["sharded", "local", "7.0", "loadbalanced"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          TOPOLOGY: "sharded_cluster"
          MONGODB_VERSION: "7.0"
          LOAD_BALANCER: "true"
          SSL: "yes"
      - func: "start load balancer"
      - func: "run tests"
        vars:
          MONGODB_URI: "${SINGLE_MONGOS_LB_URI}"
          SSL: "yes"

  - name: "test-mongodb-6.0-loadbalanced"
    tags: ["sharded", "local", "6.0", "loadbalanced"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          TOPOLOGY: "sharded_cluster"
          MONGODB_VERSION: "6.0"
          LOAD_BALANCER: "true"
          SSL: "yes"
      - func: "start load balancer"
      - func: "run tests"
        vars:
          MONGODB_URI: "${SINGLE_MONGOS_LB_URI}"
          SSL: "yes"

  - name: "test-mongodb-5.0-loadbalanced"
    tags: ["sharded", "local", "5.0", "loadbalanced"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          TOPOLOGY: "sharded_cluster"
          MONGODB_VERSION: "5.0"
          LOAD_BALANCER: "true"
          SSL: "yes"
      - func: "start load balancer"
      - func: "run tests"
        vars:
          # Note: loadBalanced=true should already be appended to SINGLE_MONGOS_LB_URI
          MONGODB_URI: "${SINGLE_MONGOS_LB_URI}"
          SSL: "yes"
