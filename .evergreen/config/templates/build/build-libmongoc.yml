# The following tasks are used to build with different libmongoc versions.
# If libmongoc is not set to a stable version, disable the first two builds and only leave the last one enabled.
# When updating libmongoc to a stable release, make sure all builds are enabled.
# These tasks are used in the build task group "build-php-libmongoc" defined in .evergreen/config/build-task-groups.yml,
# where the "max_hosts" setting must be set to the number of enabled tasks.
# Last but not least, make sure the corresponding test variants are enabled in .evergreen/config/test-variants.yml
tasks:
  - name: "build-php-%phpVersion%-libmongoc-lowest-supported"
    tags: ["build-libmongoc", "php%phpVersion%"]
    commands:
      - func: "compile driver"
        vars:
          PHP_VERSION: "%phpVersion%"
          LIBMONGOC_VERSION: "1eacb5d46f39c5404586e5d3d32e4bf9e6670bd2"
      - func: "upload build"

  - name: "build-php-%phpVersion%-libmongoc-next-stable"
    tags: ["build-libmongoc", "php%phpVersion%"]
    commands:
      - func: "compile driver"
        vars:
          PHP_VERSION: "%phpVersion%"
           # TODO: change to r1.26 once 1.26.0 is released
          LIBMONGOC_VERSION: "1eacb5d46f39c5404586e5d3d32e4bf9e6670bd2"
      - func: "upload build"

  - name: "build-php-%phpVersion%-libmongoc-latest"
    tags: ["build-libmongoc", "php%phpVersion%"]
    commands:
      - func: "compile driver"
        vars:
          PHP_VERSION: "%phpVersion%"
          LIBMONGOC_VERSION: "master"
      - func: "upload build"
